Лабораторная № 1 по технологиям компьютерных сетей
===================================================

Инструкция по использованию
---------------------------------------------------

### Сборка

Сборка происходит с использованием Gradle (встроен в репозиторий) и JDK 1.8+.

Для сборки выполните команду

    ./gradlew assemble
    
Данная команда соберёт все подпроекты. Если в системе отсутствует JavaFX, то тогда можно собрать только проекты `schat-client-cli` и `schat-server`. Запуск этих проектов через Gradle приведёт к автоматической сборке.

Чтобы подготовить дистрибутив программы, выполните команду:

    ./gradlew install

После этого программы будут расположены здесь по путям `subprojects/*/build/install/*`.

### Сервер

Запуск сервера можно осуществить с помощью команды

    ./gradlew :schat-server:run --args='[--log <level>] [ip_address[:port]]'

Опции:
- `--log` уровень логирования (варианты: `all|trace|debug|info|warn|error|no`)

Аргументы:
- `ip_address[:port]` адрес для прослушивания TCP подключений. По умолчанию `0.0.0.0:2469`

### Клиент (командная строка)

Клиент запускается командой

    ./gradlew :schat-client-cli:run --args='[[username@]host[:port]]'

Единственный аргумент здесь указывает имя пользователя и адрес подключения. По умолчанию поля в аргументе заданы следующим образом:
- **username** -- случайное имя из внутреннего списка
- **host** -- имеет значение `localhost`
- **port** -- значение `2469`

Во время работы клиента каждая строка из stdin рассматривается как отдельное сообщение. По закрытии stdin клиент завершается и отключается от сервера. В stdout будут приходить сообщение в указанном в задании формате.

### Клиент (графический интерфейс)

Его можно запустить командой

    ./gradlew :schat-client-gui:run

В начальном окне требуется ввести строку формата `[username@]host[:port]`, который был описан ранее. После откроется окно чата.

Описание используемого протокола
---------------------------------------------------

Протокол делится на две фазы: инициализация и работа.

### Инициализация

После формирования TCP соединения клиент должен отправить в течение трёх секунд имя, которое будет использовано в чате.

Формат имени следующий:

|Длина закодированного имени|Имя|
|---|---|
|int32|UTF-8 строка|

Размер поля "Имя" зависит от значения в поле "Длина закодированного имени".

После отправки осуществляется переход в режим работы.

### Работа

Во время работы клиент и сервер могут отсылать друг другу сообщения. При этом от клиента всегда ожидается сообщение формата Say, а от сервера сообщение формата Message

Формат Say:

|Длина закодированного сообщения|Сообщение|
|---|---|
|int32|UTF-8 строка|

После получения сообщения Say от любого клиента, который перешёл во вторую фазу, сервер отправляет всем клиентам сообщение Message следующего формата:

|Временная метка|Длина имени|Имя отправителя|Длина сообщения|Сообщение|
|---|---|---|---|---|
|int64|int32|UTF-8 строка|int32|UTF-8 строка|

Временная метка это UNIX формат времени в секундах.

Остальные поля подобны тому, что было описано в форматах сообщений других типов.
