# Система поиска/публикации новостей

## Задание

Разработать приложение–клиент и приложение–сервер системы поиска/публикации новостей. Новости сгруппированы по темам. Каждая новость имеет уникальный идентификатор, название и текст новости.

### Серверная часть

Серверное приложение должно реализовывать следующие функции:

1. Прослушивание определенного порта
2. Обработка запросов на подключение по этому порту от клиентов системы поиска/публикации новостей
3. Поддержка одновременной работы нескольких клиентов системы поиска/публикации новостей через механизм нитей
4. Прием запросов от клиента на передачу списка тем, списка новостей по теме, текста новости, добавление новости по теме
5. Осуществление добавления тем, новостей по темам
6. Передача списков тем, списков новостей и текстов новостей
7. Обработка запроса на отключение клиента
8. Принудительное отключение клиента

### Клиентская часть

Клиентское приложение должно реализовывать следующие функции:

1. Установление соединения с сервером
2. Передача запросов на передачу списка тем, списка новостей по теме, текста новости, добавление новости по теме
3. Получение результатов от сервера
4. Разрыв соединения
5. Обработка ситуации отключения клиента сервером

## Протокол

Протокол использует [общий формат](shared-proto.md) кодирования данных.

### Описание пакетов

#### *GetAllThemes*

ID пакета: 1

Пакет не имеет дополнительных данных. Он обозначает команду запроса всех тем новостей, что есть на сервере. Сервер ответит пакетом *AllThemes*.

#### *AllThemes*

ID пакета: 2

Содержимое пакета:

|Тип данных|Описание|
|---|---|
|Unsigned LEB128|Размер списка тем новостей|
|Список из string|Последовательность из названий тем в количестве, определяемым полем выше|

Этот пакет является ответом сервера на запрос *GetAllThemes*.

#### *GetNews*

ID пакета: 3

Содержимое пакета:

|Тип данных|Описание|
|---|---|
|string|Название темы, по которому запрашивается список новостей. Пустая строка означает все темы.|

Это запрос от клиента, на который сервер ответит пакетом *News*.

#### *News*

ID пакета: 4

Содержимое пакета:

|Тип данных|Описание|
|---|---|
|Unsigned LEB128|Размер списка новостей|
|Список post head|Список элементов типа post head в количестве, определяемым полем выше|

Содержимое post head:

|Тип данных|Описание|
|---|---|
|uint32|Идентификатор новости|
|string|Название новости|

#### *GetPost*

ID пакета: 5

Содержимое пакета:

|Тип данных|Описание|
|---|---|
|uint32|Идентификатор новости|

Этот пакет - запрос данных о конкретной новости по её идентификатору. Ответом на этот запрос будет пакет *Post*.

#### *Post*

ID пакета: 6

Содержимое пакета:

|Тип данных|Описание|
|---|---|
|uint32|Идентификатор новости|
|string|Название новости|
|Unsigned LEB128|Размер списка тем этой новости|
|Список из string|Последовательность из названий тем в количестве, определяемым полем выше|
|string|Текст новости|

#### *AddPost*

ID пакета: 7

Содержимое пакета:

|Тип данных|Описание|
|---|---|
|string|Название новости|
|Unsigned LEB128|Размер списка тем этой новости|
|Список из string|Последовательность из названий тем в количестве, определяемым полем выше|
|string|Текст новости|

Этот пакет является запросом на добавление новости на сервер. Ответом на него будет пакет *PostId*.

#### *PostId*

ID пакета: 8

Содержимое пакета:

|Тип данных|Описание|
|---|---|
|uint32|Идентификатор добавленной новости|

## Сервер

Выполнил Николай Голзицкий.

Сервер запускается командой:

    ./news-server [--host <address>] [--port <port>]

Адрес хоста задаётся опцией **--host**, номер порта опцией **--port**.

По умолчанию address = `localhost` и port = `6969`.

## Клиент

Выполнил Антон Натура.

Для работы клиента необходим модуль Python [py-cui](https://github.com/jwlodek/py_cui).

Установка модуля:

    pip3 install -r requirements.txt

Клиент запускается командой:

    ./news-client [--host <address>] [--port <port>]

Смысл и значения по умолчанию у опций данной команды аналогичны тем, что в программе сервера.

После удачного подключения клиент отображает в терминале окно со списком тем, списком новостей по теме и виджет для просмотра новости. Присутствуют кнопки добавления новости и обновления списков тем новостей и новостей по выбранной теме.

Выбор темы осуществляется навигацией по списку тем и нажатием клавиши Enter. То же самое следует сделать для отображения новости.

Выход из приложения осуществляется нажатием клавиши **q** (работает, когда нет фокусировки на виджете) или сочетанием клавиш **Ctrl+C**.

Перемещение между виджетами осуществляется стрелочками на клавиатуре. Расфокусировка виджета осуществляется клавишей **ESC**. Фокусировка клавишей **Enter**.
